{{define "chart"}}
<div class="box">
    <h3 class="title is-5">Compliance Overview</h3>
    <canvas id="complianceChart"></canvas>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('complianceChart').getContext('2d');

        const chartData = {
            labels: ['Passed', 'Failed'],
            datasets: [{
                data: [{{.PassedQueries}}, {{.FailedQueries}}],
                backgroundColor: [
                    'rgba(72, 199, 142, 0.8)',
                    'rgba(241, 70, 104, 0.8)'
                ],
                borderColor: [
                    'rgba(72, 199, 142, 1)',
                    'rgba(241, 70, 104, 1)'
                ],
                borderWidth: 2
            }]
        };

        const config = {
            type: 'doughnut',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: {
                                size: 14,
                                family: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"
                            },
                            padding: 20,
                            color: getComputedStyle(document.documentElement).getPropertyValue('--text-color') || '#363636'
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.parsed || 0;
                                const total = {{.TotalQueries}};
                                const percentage = ((value / total) * 100).toFixed(1);
                                return label + ': ' + value + ' (' + percentage + '%)';
                            }
                        }
                    }
                },
                animation: {
                    animateRotate: true,
                    animateScale: true,
                    duration: 1000,
                    easing: 'easeInOutQuart'
                }
            }
        };

        window.complianceChart = new Chart(ctx, config);
    });

    function updateChartTheme(theme) {
        if (window.complianceChart) {
            const textColor = theme === 'dark' ? '#f5f5f5' : '#363636';
            window.complianceChart.options.plugins.legend.labels.color = textColor;
            window.complianceChart.update();
        }
    }
</script>
{{end}}
